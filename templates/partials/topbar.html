{% load static %}

<nav class="navbar navbar-expand px-4 topbar-navbar">
  <!-- Хлебные крошки -->
  <ol class="breadcrumb mb-0 align-items-center py-2 flex-nowrap">
    {% block breadcrumbs %}
      <li class="breadcrumb-item active text-nowrap fs-6 fw-semibold">
        <i class="bi bi-house me-1 opacity-50"></i>Товары / Склад
      </li>
    {% endblock %}
  </ol>

  <!-- Профиль пользователя -->
  <div class="ms-auto dropdown d-flex align-items-center">
    <!-- Кнопка с маленькой аватаркой -->
    <button
      class="btn profile-btn dropdown-toggle p-0 rounded-circle border-0"
      id="userDropdown"
      data-bs-toggle="dropdown"
      aria-expanded="false"
      aria-label="Профиль"
    >
      {% if request.user.is_authenticated and request.user.profile.avatar %}
        <img src="{{ request.user.profile.avatar.url }}"
             alt="Аватар"
             class="rounded-circle shadow avatar-img"
             width="40"
             height="40">
      {% else %}
        <img src="{% static 'avatars/default.png' %}"
             alt="Аватар по умолчанию"
             class="rounded-circle shadow avatar-img"
             width="40"
             height="40">
      {% endif %}
    </button>

    <!-- Выпадающее меню профиля -->
    <ul class="dropdown-menu dropdown-menu-end shadow-lg animated fadeInMenu border-0 mt-2" aria-labelledby="userDropdown" style="min-width: 230px;">
      <li>
        <div class="text-center py-2">
          {% if request.user.is_authenticated and request.user.profile.avatar %}
            <img src="{{ request.user.profile.avatar.url }}"
                 alt="Аватар"
                 class="rounded-circle mb-2"
                 width="56"
                 height="56">
          {% else %}
            <img src="{% static 'avatars/default.png' %}"
                 alt="Аватар по умолчанию"
                 class="rounded-circle mb-2"
                 width="56"
                 height="56">
          {% endif %}
          <div class="fw-semibold fs-6 mt-1">{{ request.user.username }}</div>
        </div>
      </li>
      <li><hr class="dropdown-divider my-1"></li>
      <li>
        <a class="dropdown-item d-flex align-items-center" href="{% url 'update_profile' %}">
          <i class="bi bi-person-circle me-2 opacity-75 fs-5"></i>Профиль
        </a>
      </li>
      <li>
        <a class="dropdown-item d-flex align-items-center" href="{% url 'change_password' %}">
          <i class="bi bi-key me-2 opacity-75 fs-5"></i>Сменить пароль
        </a>
      </li>
      <li><hr class="dropdown-divider my-1"></li>
      <li>
        <form action="{% url 'logout' %}?next={{ request.path }}" method="post" style="display:inline;">
          {% csrf_token %}
          <button type="submit"
                  class="dropdown-item d-flex align-items-center"
                  style="background:none;border:none;padding:0 1.5rem;width:100%;text-align:left;">
            <i class="bi bi-box-arrow-right me-2 opacity-75 fs-5"></i>Выйти
          </button>
        </form>
      </li>
    </ul>
  </div>
</nav>
